# spring-security-demo

–î–µ–º–æ-–ø—Ä–æ–µ–∫—Ç –¥–ª—è –º–∏—Ç–∞–ø–∞ –ø–æ Spring Security

# –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

1. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –≤–µ—Ç–∫–µ
2. –ü–æ—á–∫–æ–≤–∞—Ç—å—Å—è –æ—Ç `main`
3. PR —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤ `main`
4. –í –Ω–∞–∑–≤–∞–Ω–∏–∏ PR —É–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä–∞ –∑–∞–¥–∞–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
5. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ –æ–¥–Ω–æ–º—É PR –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ, –º–æ–∂–Ω–æ —Å—Ä–∞–∑—É –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º PR
6. –ó–∞–¥–∞–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏, –∫–æ–≥–¥–∞ –≤—Å–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ PR –∑–∞–∫—Ä—ã—Ç (–≤ `main` –Ω–∏—á–µ–≥–æ –Ω–µ
   –∑–∞–ª–∏–≤–∞–µ–º)

## –ù–∞–∑–≤–∞–Ω–∏—è –≤–µ—Ç–æ–∫, –∫–æ–º–º–∏—Ç–æ–≤ –∏ PR

1. –ù–∞–∑–≤–∞–Ω–∏–µ –≤–µ—Ç–∫–∏: `security-<–Ω–∏–∫_github>`
2. –ù–∞–∑–≤–∞–Ω–∏–µ PR: `–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ1`, –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–¥–∞–Ω–∏–π –≤ –æ–¥–Ω–æ–º PR,
   —Ç–æ `–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ ‚Ññ1, 2, 5`
3. –ù–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–º–∏—Ç–æ–≤: `–û—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ`

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ1: –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –≤–º–µ—Å—Ç–æ DTO (üß†/5)

## üîπ 1. –¶–µ–ª—å

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω—ã (access –∏ refresh) –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ (DTO). –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏–∑–º–µ–Ω–∏—Ç—å
–ø–æ–¥—Ö–æ–¥, —á—Ç–æ–±—ã —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å —á–µ—Ä–µ–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏.

üìå **–¢–æ–∫–µ–Ω—ã –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö –æ—Ç–≤–µ—Ç–∞ –≤–º–µ—Å—Ç–æ DTO**

## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –ò–∑–º–µ–Ω–∏—Ç—å —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–∞—Ö

- –í–º–µ—Å—Ç–æ —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞ (DTO), –∏—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤
  HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö. –ù–∞–ø—Ä–∏–º–µ—Ä:
    - `Authorization: Bearer <access_token>`
    - `Refresh-Token: <refresh_token>`

---

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ2: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ `UserService` –∏ `UserDetailsService` (üß†/5)

## üîπ 1. –¶–µ–ª—å

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `UserService` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å—Ä–∞–∑—É –¥–≤–µ –∑–∞–¥–∞—á–∏:

1. **–†–∞–±–æ—Ç—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ–∏—Å–∫, –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)**
2. **–ó–∞–≥—Ä—É–∑–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è Spring Security (—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `UserDetailsService`)**

üìå **–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å —ç—Ç–∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ–±—ã `UserService` –∑–∞–Ω–∏–º–∞–ª—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π,
–∞ `UserDetailsService` —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.**


## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –°–æ–∑–¥–∞—Ç—å `CustomUserDetailsService`, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç `UserDetailsService`

- –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –º–µ—Ç–æ–¥ `loadUserByUsername()` –∏–∑ `UserService`.

### ‚úÖ 2.2. –û–±–Ω–æ–≤–∏—Ç—å `UserService`

- –£–¥–∞–ª–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `UserDetailsService`.
- –û—Å—Ç–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫
  –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–µ (`createNewUser()`, `findByUsername()`, `getCurrentUserInfo()`).

### ‚úÖ 2.3. –û–±–Ω–æ–≤–∏—Ç—å `SecurityConfig`

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `CustomUserDetailsService` –∫–∞–∫ –±–∏–Ω –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.

---

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è logout —Å —É–¥–∞–ª–µ–Ω–∏–µ–º refresh-—Ç–æ–∫–µ–Ω–∞ (üß†üß†/5)

## üîπ 1. –¶–µ–ª—å

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ logout –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —É–¥–∞–ª–µ–Ω–∏—è refresh-—Ç–æ–∫–µ–Ω–∞. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å
–ø—Ä–æ—Ü–µ—Å—Å logout, —á—Ç–æ–±—ã –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã refresh-—Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–ª—Å—è, –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ–ª—å—à–µ –Ω–µ –º–æ–≥
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ access-—Ç–æ–∫–µ–Ω–∞.

üìå **–ü—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã refresh-—Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —É–¥–∞–ª—è—Ç—å—Å—è, –∏ —Å–µ—Å—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å
–∑–∞–≤–µ—Ä—à–µ–Ω–∞.**


## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –°–æ–∑–¥–∞—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è logout

- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è logout, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —É–¥–∞–ª—è—Ç—å refresh-—Ç–æ–∫–µ–Ω. –≠—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –º–æ–∂–µ—Ç
  –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ4: –ü–µ—Ä–µ–Ω–æ—Å —Ö—Ä–∞–Ω–µ–Ω–∏—è refresh-—Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ PostgreSQL –≤ Redis (üß†üß†üß†/5)

## üîπ 1. –¶–µ–ª—å

–°–µ–π—á–∞—Å refresh-—Ç–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ **–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Ö –≤ Redis**, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å:

- **–ë–æ–ª–µ–µ –±—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ** (Redis —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏).
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ TTL** (—Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Å—Ä–æ–∫–∞).
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** (–ª–µ–≥–∫–æ—Å—Ç—å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è).

## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –û—Ç–∫–ª—é—á–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh-—Ç–æ–∫–µ–Ω–æ–≤ –≤ PostgreSQL

- –£–¥–∞–ª–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ **JPA Repository** –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤.
- –£–¥–∞–ª–∏—Ç—å JPA-—Å—É—â–Ω–æ—Å—Ç—å `RefreshToken` (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å).
- –£–¥–∞–ª–∏—Ç—å –∫–æ–¥, —Å–≤—è–∑–∞–Ω–Ω—ã–π —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∏ —É–¥–∞–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤ –≤ PostgreSQL.

### ‚úÖ 2.2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å Redis –≤ Spring Boot

- –î–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å `spring-boot-starter-data-redis` –≤ `pom.xml`.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis –≤ `application.yml`.
- –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `RefreshTokenService` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis.

### ‚úÖ 2.3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ refresh-—Ç–æ–∫–µ–Ω–æ–≤ –≤ Redis

- –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ **Redis** —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ **userId**.
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å **TTL (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –¥–Ω–µ–π)**.
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è **—Å–æ–∑–¥–∞–Ω–∏—è, –ø–æ–ª—É—á–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è** refresh-—Ç–æ–∫–µ–Ω–∞.

### ‚úÖ 2.4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ç–æ–∫–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∏ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ Redis.
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`logout`) –µ–≥–æ —Ç–æ–∫–µ–Ω —É–¥–∞–ª—è–µ—Ç—Å—è.
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Redis —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å).

---

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ5: –î–æ–±–∞–≤–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –†–æ–ª–µ–π –∏ –ü—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (üß†üß†üß†üß†/5)

## üîπ 1. –¶–µ–ª—å

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–º–µ—Ö–∞–Ω–∏–∑–º —Ä–æ–ª–µ–π –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π** –≤ —Å–∏—Å—Ç–µ–º–µ, —á—Ç–æ–±—ã —É–ø—Ä–∞–≤–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–æ–º
–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫ —Ä–∞–∑–ª–∏—á–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º.

- **–†–æ–ª–∏ (Roles)** ‚Äì –≥—Ä—É–ø–ø—ã —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `ADMIN`, `USER`).
- **–ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ (Privileges)** ‚Äì **–∂–µ—Å—Ç–∫–æ –∑–∞—à–∏—Ç—ã –≤ –∫–æ–¥–µ** –∏ –Ω–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î.
- **–°–≤—è–∑—å "–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º"** –º–µ–∂–¥—É —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏.
- **–°–≤—è–∑—å "–º–Ω–æ–≥–∏–µ –∫–æ –º–Ω–æ–≥–∏–º"** –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Ä–æ–ª—è–º–∏.
- **–í `GrantedAuthorities` –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏**.
- **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `@PreAuthorize(hasAuthority)`**.

## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –°–æ–∑–¥–∞—Ç—å `enum Privilege`

- –ü—Ä–∏–≤–∏–ª–µ–≥–∏–∏ –±—É–¥—É—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω—ã –≤ –∫–æ–¥–µ –∏ **–Ω–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ë–î**.

### ‚úÖ 2.2. –°–æ–∑–¥–∞—Ç—å —Å—É—â–Ω–æ—Å—Ç—å `Role`

- –¢–∞–±–ª–∏—Ü–∞ `roles` (—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è).
- –¢–∞–±–ª–∏—Ü–∞ `users_roles` (—Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏).

### ‚úÖ 2.3. –°–æ–∑–¥–∞—Ç—å JPA-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–ª—è —Ä–æ–ª–µ–π

- `RoleRepository`

### ‚úÖ 2.4. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å `RoleService`

- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–æ–ª–µ–π (—Å –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–º–∏ –∫ –Ω–∏–º –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏).
- –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

### ‚úÖ 2.5. **–û–±–Ω–æ–≤–∏—Ç—å `CustomUserDetails` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∏–≤–∏–ª–µ–≥–∏—è–º–∏**

- –í `GrantedAuthorities` –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è **–ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏** –≤–º–µ—Å—Ç–æ —Ä–æ–ª–µ–π.

### ‚úÖ 2.6. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ `@PreAuthorize(hasAuthority)`**

–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ —Ä–æ–ª–∏ –±—É–¥–µ—Ç –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–∏—Å—Ç–µ–º—ã.
---

# üìå –ó–∞–¥–∞–Ω–∏–µ ‚Ññ6: –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –∫ –∫–ª—é—á–∞–º –¥–ª—è JWT (üß†üß†üß†üß†üß†/5)

## üîπ 1. –¶–µ–ª—å

–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ JWT –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–∫—Ä–µ—Ç—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤. –ù—É–∂–Ω–æ
–∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–¥—Ö–æ–¥, –∑–∞–º–µ–Ω–∏–≤ —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ –ø–∞—Ä—É –∫–ª—é—á–µ–π (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è
–±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

**–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ –ø–∞—Ä—ã –∫–ª—é—á–µ–π (RSA) –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT-—Ç–æ–∫–µ–Ω–æ–≤.**

---

## üîπ 2. –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?

### ‚úÖ 2.1. –°–æ–∑–¥–∞—Ç—å –ø–∞—Ä—É –∫–ª—é—á–µ–π (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π)

- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä—É –∫–ª—é—á–µ–π (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π) –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø–æ–¥–ø–∏—Å–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT.

### ‚úÖ 2.2. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π

- –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—É—Ç–∏ –∫ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∏ –ø—É–±–ª–∏—á–Ω–æ–º—É
  –∫–ª—é—á–∞–º.

### ‚úÖ 2.3. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–ª—é—á–µ–π –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ JWT

- –ó–∞–º–µ–Ω–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–µ–π.

## üìå 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

JWT —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
–ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞.
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö —Å—Ç—Ä–æ–∫ –¥–ª—è JWT.
–ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–æ–≤.

## ü§î –ü–æ–¥—Å–∫–∞–∑–∫–∞

–ö–æ–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π (–ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –≤ `application.yaml`)

```java
        Security.addProvider(new BouncyCastleProvider());

        KeyPairGenerator keyGen=KeyPairGenerator.getInstance("EC","BC");
        keyGen.initialize(new ECGenParameterSpec("secp256r1"));
        KeyPair keyPair=keyGen.generateKeyPair();

        byte[]privateKeyBytes=keyPair.getPrivate().getEncoded();
        String privateKeyBase64=Base64.getEncoder().encodeToString(privateKeyBytes);

        byte[]publicKeyBytes=keyPair.getPublic().getEncoded();
        String publicKeyBase64=Base64.getEncoder().encodeToString(publicKeyBytes);

        System.out.println("Private Key (PKCS8, Base64): "+privateKeyBase64);
        System.out.println("Public Key (X.509, Base64): "+publicKeyBase64);
```

